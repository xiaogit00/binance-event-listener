2025-06-11 18:43:00 | ERROR  | base_events.py::default_exception_handler() | Task was destroyed but it is pending!
task: <Task cancelling name='Task-2' coro=<websocket_binance_event_listener() running at /Users/lei/p/binance-event-listener/src/services/binanceWebsocket.py:35> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:922, Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:767]>
2025-06-11 18:43:00 | ERROR  | base_events.py::default_exception_handler() | Task was destroyed but it is pending!
task: <Task cancelling name='Task-5' coro=<WebSocketCommonProtocol.close_connection() running at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/site-packages/websockets/legacy/protocol.py:1311> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:922, Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:767, shield.<locals>._inner_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:905]>
2025-06-11 18:43:07 | INFO   | binanceWebsocket.py::websocket_binance_event_listener() | Connecting to wss://fstream.binance.com/ws/0ayJYiBVmz0TALoaZoJh5wLgJLELP8sSDq2G959M89e26e8aLZ0Ny3mBn8LmYTAk
2025-06-11 18:43:08 | INFO   | binanceWebsocket.py::websocket_binance_event_listener() | âœ… Connected to Binance event listening websocket
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'TRADE_LITE', 'E': 1749638616249, 'T': 1749638616249, 's': 'SOLUSDT', 'q': '0.09', 'p': '0.0000', 'm': False, 'c': '8y8ISK4BTzOqbItaYqNKp1', 'S': 'BUY', 'L': '164.2600', 'l': '0.09', 't': 2385598671, 'i': 122478226898}
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749638616249, 'E': 1749638616249, 'o': {'s': 'SOLUSDT', 'c': '8y8ISK4BTzOqbItaYqNKp1', 'S': 'BUY', 'o': 'MARKET', 'f': 'GTC', 'q': '0.09', 'p': '0', 'ap': '0', 'sp': '0', 'x': 'NEW', 'X': 'NEW', 'i': 122478226898, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749638616249, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 18:43:36 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122478226898, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'MARKET', 'qty': '0.09', 'direction': 'LONG', 'created_at': 1749638616249}
2025-06-11 18:43:36 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 18:43:36 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749638616249, 'E': 1749638616249, 'a': {'B': [{'a': 'USDT', 'wb': '93.23375507', 'cw': '93.23375507', 'bc': '0'}], 'P': [{'s': 'SOLUSDT', 'pa': '0.09', 'ep': '164.26', 'cr': '6.19990011', 'up': '0', 'mt': 'cross', 'iw': '0', 'ps': 'BOTH', 'ma': 'USDT', 'bep': '164.34213'}], 'm': 'ORDER'}}
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:36 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749638616249, 'E': 1749638616249, 'o': {'s': 'SOLUSDT', 'c': '8y8ISK4BTzOqbItaYqNKp1', 'S': 'BUY', 'o': 'MARKET', 'f': 'GTC', 'q': '0.09', 'p': '0', 'ap': '164.26', 'sp': '0', 'x': 'TRADE', 'X': 'FILLED', 'i': 122478226898, 'l': '0.09', 'z': '0.09', 'L': '164.26', 'n': '0.0073917', 'N': 'USDT', 'T': 1749638616249, 't': 2385598671, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 18:43:36 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122478226898, 'status': 'FILLED', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'MARKET', 'qty': '0.09', 'direction': 'LONG', 'ask_price': '164.26', 'filled_price': '164.26', 'updated_at': 1749638616249}
2025-06-11 18:43:36 | INFO   | db.py::findByIdAndUpdateFilledMarketOrder() | Attempting to UPDATE order 122478226898 to FILLED
2025-06-11 18:43:36 | INFO   | _client.py::_send_single_request()    | HTTP Request: PATCH https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders?order_id=eq.122478226898 "HTTP/2 200 OK"
2025-06-11 18:43:36 | INFO   | db.py::get_group_id_by_order()        | Trying to get latest group_id by order: 122478226898
2025-06-11 18:43:36 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=%2A&order_id=eq.122478226898 "HTTP/2 200 OK"
2025-06-11 18:43:36 | INFO   | db.py::get_group_id_by_order()        | No associated group_id found for order_id: 122478226898
2025-06-11 18:43:36 | INFO   | main.py::main()                       | No group_id found for order, inserting a new entry in order_groups table
2025-06-11 18:43:36 | INFO   | db.py::get_latest_group_id()          | Trying to get the latest group_id
2025-06-11 18:43:36 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=group_id&order=group_id.desc&limit=1 "HTTP/2 200 OK"
2025-06-11 18:43:36 | INFO   | db.py::get_latest_group_id()          | Retrieved data=[] count=0 from db
2025-06-11 18:43:36 | INFO   | db.py::get_latest_group_id()          | No latest groupId found from group_orders table
2025-06-11 18:43:36 | INFO   | db.py::insertNewOrderGroup()          | Trying to insert a new order_group record
2025-06-11 18:43:36 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups "HTTP/2 201 Created"
2025-06-11 18:43:36 | INFO   | db.py::insertNewOrderGroup()          | Successfully inserted new entry with group_id 0 into order_group table.
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'TRADE_LITE', 'E': 1749638632359, 'T': 1749638632359, 's': 'SOLUSDT', 'q': '0.09', 'p': '0.0000', 'm': False, 'c': 'lo9qbRzhaWJqSTiu42V45q', 'S': 'BUY', 'L': '164.2700', 'l': '0.09', 't': 2385600359, 'i': 122478267569}
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749638632359, 'E': 1749638632360, 'o': {'s': 'SOLUSDT', 'c': 'lo9qbRzhaWJqSTiu42V45q', 'S': 'BUY', 'o': 'MARKET', 'f': 'GTC', 'q': '0.09', 'p': '0', 'ap': '0', 'sp': '0', 'x': 'NEW', 'X': 'NEW', 'i': 122478267569, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749638632359, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 18:43:52 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122478267569, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'MARKET', 'qty': '0.09', 'direction': 'LONG', 'created_at': 1749638632359}
2025-06-11 18:43:52 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 18:43:52 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749638632359, 'E': 1749638632360, 'a': {'B': [{'a': 'USDT', 'wb': '93.22636292', 'cw': '93.22636292', 'bc': '0'}], 'P': [{'s': 'SOLUSDT', 'pa': '0.18', 'ep': '164.265', 'cr': '6.19990011', 'up': '0.0009', 'mt': 'cross', 'iw': '0', 'ps': 'BOTH', 'ma': 'USDT', 'bep': '164.3471325'}], 'm': 'ORDER'}}
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:43:52 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749638632359, 'E': 1749638632360, 'o': {'s': 'SOLUSDT', 'c': 'lo9qbRzhaWJqSTiu42V45q', 'S': 'BUY', 'o': 'MARKET', 'f': 'GTC', 'q': '0.09', 'p': '0', 'ap': '164.27', 'sp': '0', 'x': 'TRADE', 'X': 'FILLED', 'i': 122478267569, 'l': '0.09', 'z': '0.09', 'L': '164.27', 'n': '0.00739215', 'N': 'USDT', 'T': 1749638632359, 't': 2385600359, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 18:43:52 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122478267569, 'status': 'FILLED', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'MARKET', 'qty': '0.09', 'direction': 'LONG', 'ask_price': '164.27', 'filled_price': '164.27', 'updated_at': 1749638632359}
2025-06-11 18:43:52 | INFO   | db.py::findByIdAndUpdateFilledMarketOrder() | Attempting to UPDATE order 122478267569 to FILLED
2025-06-11 18:43:52 | INFO   | _client.py::_send_single_request()    | HTTP Request: PATCH https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders?order_id=eq.122478267569 "HTTP/2 200 OK"
2025-06-11 18:43:52 | INFO   | db.py::get_group_id_by_order()        | Trying to get latest group_id by order: 122478267569
2025-06-11 18:43:52 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=%2A&order_id=eq.122478267569 "HTTP/2 200 OK"
2025-06-11 18:43:52 | INFO   | db.py::get_group_id_by_order()        | No associated group_id found for order_id: 122478267569
2025-06-11 18:43:52 | INFO   | main.py::main()                       | No group_id found for order, inserting a new entry in order_groups table
2025-06-11 18:43:52 | INFO   | db.py::get_latest_group_id()          | Trying to get the latest group_id
2025-06-11 18:43:52 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=group_id&order=group_id.desc&limit=1 "HTTP/2 200 OK"
2025-06-11 18:43:52 | INFO   | db.py::get_latest_group_id()          | Retrieved data=[{'group_id': 0}] count=1 from db
2025-06-11 18:43:52 | INFO   | db.py::insertNewOrderGroup()          | Trying to insert a new order_group record
2025-06-11 18:43:52 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups "HTTP/2 201 Created"
2025-06-11 18:43:52 | INFO   | db.py::insertNewOrderGroup()          | Successfully inserted new entry with group_id 0 into order_group table.
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'TRADE_LITE', 'E': 1749638674180, 'T': 1749638674179, 's': 'SOLUSDT', 'q': '0.18', 'p': '0.0000', 'm': False, 'c': 'android_VT8pA4H7HuKbVzrkefDW', 'S': 'SELL', 'L': '164.3700', 'l': '0.18', 't': 2385605905, 'i': 122478424884}
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749638674179, 'E': 1749638674180, 'o': {'s': 'SOLUSDT', 'c': 'android_VT8pA4H7HuKbVzrkefDW', 'S': 'SELL', 'o': 'MARKET', 'f': 'GTC', 'q': '0.18', 'p': '0', 'ap': '0', 'sp': '0', 'x': 'NEW', 'X': 'NEW', 'i': 122478424884, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749638674179, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': True, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 18:44:34 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122478424884, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'SELL', 'type': 'MARKET', 'qty': '0.18', 'direction': 'SHORT', 'created_at': 1749638674179}
2025-06-11 18:44:34 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 18:44:34 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749638674179, 'E': 1749638674180, 'a': {'B': [{'a': 'USDT', 'wb': '93.23046962', 'cw': '93.23046962', 'bc': '0'}], 'P': [{'s': 'SOLUSDT', 'pa': '0', 'ep': '0', 'cr': '6.21880011', 'up': '0', 'mt': 'cross', 'iw': '0', 'ps': 'BOTH', 'ma': 'USDT', 'bep': '0'}], 'm': 'ORDER'}}
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 18:44:34 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749638674179, 'E': 1749638674180, 'o': {'s': 'SOLUSDT', 'c': 'android_VT8pA4H7HuKbVzrkefDW', 'S': 'SELL', 'o': 'MARKET', 'f': 'GTC', 'q': '0.18', 'p': '0', 'ap': '164.37', 'sp': '0', 'x': 'TRADE', 'X': 'FILLED', 'i': 122478424884, 'l': '0.18', 'z': '0.18', 'L': '164.37', 'n': '0.0147933', 'N': 'USDT', 'T': 1749638674179, 't': 2385605905, 'b': '0', 'a': '0', 'm': False, 'R': True, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0.0189', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 18:44:34 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122478424884, 'status': 'FILLED', 'symbol': 'SOLUSDT', 'side': 'SELL', 'type': 'MARKET', 'qty': '0.18', 'direction': 'SHORT', 'ask_price': '164.37', 'filled_price': '164.37', 'updated_at': 1749638674179}
2025-06-11 18:44:34 | INFO   | db.py::findByIdAndUpdateFilledMarketOrder() | Attempting to UPDATE order 122478424884 to FILLED
2025-06-11 18:44:34 | INFO   | _client.py::_send_single_request()    | HTTP Request: PATCH https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders?order_id=eq.122478424884 "HTTP/2 200 OK"
2025-06-11 18:44:34 | INFO   | db.py::get_group_id_by_order()        | Trying to get latest group_id by order: 122478424884
2025-06-11 18:44:34 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=%2A&order_id=eq.122478424884 "HTTP/2 200 OK"
2025-06-11 18:44:34 | INFO   | db.py::get_group_id_by_order()        | No associated group_id found for order_id: 122478424884
2025-06-11 18:44:34 | INFO   | main.py::main()                       | No group_id found for order, inserting a new entry in order_groups table
2025-06-11 18:44:34 | INFO   | db.py::get_latest_group_id()          | Trying to get the latest group_id
2025-06-11 18:44:34 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=group_id&order=group_id.desc&limit=1 "HTTP/2 206 Partial Content"
2025-06-11 18:44:34 | INFO   | db.py::get_latest_group_id()          | Retrieved data=[{'group_id': 0}] count=2 from db
2025-06-11 18:44:34 | INFO   | db.py::insertNewOrderGroup()          | Trying to insert a new order_group record
2025-06-11 18:44:34 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups "HTTP/2 201 Created"
2025-06-11 18:44:34 | INFO   | db.py::insertNewOrderGroup()          | Successfully inserted new entry with group_id 0 into order_group table.
2025-06-11 18:45:13 | ERROR  | base_events.py::default_exception_handler() | Task was destroyed but it is pending!
task: <Task cancelling name='Task-2' coro=<websocket_binance_event_listener() running at /Users/lei/p/binance-event-listener/src/services/binanceWebsocket.py:35> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:922, Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:767]>
2025-06-11 18:45:13 | ERROR  | base_events.py::default_exception_handler() | Task was destroyed but it is pending!
task: <Task cancelling name='Task-5' coro=<WebSocketCommonProtocol.close_connection() running at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/site-packages/websockets/legacy/protocol.py:1311> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:922, Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:767, shield.<locals>._inner_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:905]>
