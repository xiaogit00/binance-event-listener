2025-06-11 10:57:01 | INFO   | binanceWebsocket.py::websocket_binance_event_listener() | Connecting to wss://fstream.binance.com/ws/0ayJYiBVmz0TALoaZoJh5wLgJLELP8sSDq2G959M89e26e8aLZ0Ny3mBn8LmYTAk
2025-06-11 10:57:02 | INFO   | binanceWebsocket.py::websocket_binance_event_listener() | âœ… Connected to Binance event listening websocket
2025-06-11 11:05:58 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:05:58 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749639958235, 'E': 1749639958236, 'a': {'B': [{'a': 'USDT', 'wb': '93.23342734', 'cw': '93.23342734', 'bc': '0.00295772'}], 'P': [], 'm': 'DEPOSIT'}}
2025-06-11 11:07:00 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:07:00 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'TRADE_LITE', 'E': 1749640020703, 'T': 1749640020702, 's': 'SOLUSDT', 'q': '11.23', 'p': '0.0000', 'm': False, 'c': 'VczbTxqN1mrUo37aKIOTh6', 'S': 'SELL', 'L': '164.8500', 'l': '11.23', 't': 2385636386, 'i': 122482140707}
2025-06-11 11:07:00 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:07:00 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749640020702, 'E': 1749640020703, 'o': {'s': 'SOLUSDT', 'c': 'VczbTxqN1mrUo37aKIOTh6', 'S': 'SELL', 'o': 'MARKET', 'f': 'GTC', 'q': '11.23', 'p': '0', 'ap': '0', 'sp': '0', 'x': 'NEW', 'X': 'NEW', 'i': 122482140707, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749640020702, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 11:07:00 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122482140707, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'SELL', 'type': 'MARKET', 'qty': '11.23', 'direction': 'SHORT', 'created_at': 1749640020702}
2025-06-11 11:07:00 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749640020702, 'E': 1749640020703, 'a': {'B': [{'a': 'USDT', 'wb': '92.30779459', 'cw': '92.30779459', 'bc': '0'}], 'P': [{'s': 'SOLUSDT', 'pa': '-11.23', 'ep': '164.85', 'cr': '6.21880011', 'up': '-0.1123', 'mt': 'cross', 'iw': '0', 'ps': 'BOTH', 'ma': 'USDT', 'bep': '164.767575'}], 'm': 'ORDER'}}
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749640020702, 'E': 1749640020703, 'o': {'s': 'SOLUSDT', 'c': 'VczbTxqN1mrUo37aKIOTh6', 'S': 'SELL', 'o': 'MARKET', 'f': 'GTC', 'q': '11.23', 'p': '0', 'ap': '164.85', 'sp': '0', 'x': 'TRADE', 'X': 'FILLED', 'i': 122482140707, 'l': '11.23', 'z': '11.23', 'L': '164.85', 'n': '0.92563275', 'N': 'USDT', 'T': 1749640020702, 't': 2385636386, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 11:07:01 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122482140707, 'status': 'FILLED', 'symbol': 'SOLUSDT', 'side': 'SELL', 'type': 'MARKET', 'qty': '11.23', 'direction': 'SHORT', 'ask_price': '164.85', 'filled_price': '164.85', 'updated_at': 1749640020702}
2025-06-11 11:07:01 | INFO   | db.py::findByIdAndUpdateFilledMarketOrder() | Attempting to UPDATE order 122482140707 to FILLED
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: PATCH https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders?order_id=eq.122482140707 "HTTP/2 200 OK"
2025-06-11 11:07:01 | INFO   | db.py::get_group_id_by_order()        | Trying to get latest group_id by order: 122482140707
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=%2A&order_id=eq.122482140707 "HTTP/2 200 OK"
2025-06-11 11:07:01 | INFO   | main.py::main()                       | No group_id found for order, inserting a new entry in order_groups table
2025-06-11 11:07:01 | INFO   | db.py::get_latest_group_id()          | Trying to get the latest group_id
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=group_id&order=group_id.desc&limit=1 "HTTP/2 206 Partial Content"
2025-06-11 11:07:01 | INFO   | db.py::get_latest_group_id()          | Retrieved data=[{'group_id': 0}] count=2 from db
2025-06-11 11:07:01 | INFO   | db.py::insertNewOrderGroup()          | Trying to insert a new order_group record
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups "HTTP/2 409 Conflict"
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749640021252, 'E': 1749640021253, 'o': {'s': 'SOLUSDT', 'c': 'ElWkZUGO6rOay1nUGYUwFe', 'S': 'BUY', 'o': 'STOP_MARKET', 'f': 'GTC', 'q': '11.23', 'p': '0', 'ap': '0', 'sp': '165.18', 'x': 'NEW', 'X': 'NEW', 'i': 122482141201, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749640021252, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'STOP_MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 11:07:01 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122482141201, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'STOP_MARKET', 'qty': '11.23', 'direction': 'SHORT', 'created_at': 1749640021252, 'ask_price': '165.18'}
2025-06-11 11:07:01 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 11:07:01 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749640021338, 'E': 1749640021338, 'o': {'s': 'SOLUSDT', 'c': 'NnBjeh0YMXdV7jiaaZxupQ', 'S': 'BUY', 'o': 'TAKE_PROFIT', 'f': 'GTC', 'q': '11.23', 'p': '163.62', 'ap': '0', 'sp': '163.62', 'x': 'NEW', 'X': 'NEW', 'i': 122482141285, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749640021338, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'TAKE_PROFIT', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 11:07:01 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122482141285, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'TAKE_PROFIT', 'qty': '11.23', 'direction': 'SHORT', 'created_at': 1749640021338, 'ask_price': '163.62'}
2025-06-11 11:07:01 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 11:07:01 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 19:45:53 | INFO   | binanceWebsocket.py::websocket_binance_event_listener() | Connecting to wss://fstream.binance.com/ws/0ayJYiBVmz0TALoaZoJh5wLgJLELP8sSDq2G959M89e26e8aLZ0Ny3mBn8LmYTAk
2025-06-11 19:45:53 | INFO   | binanceWebsocket.py::websocket_binance_event_listener() | âœ… Connected to Binance event listening websocket
2025-06-11 19:45:58 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 19:45:58 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'TRADE_LITE', 'E': 1749642358753, 'T': 1749642358753, 's': 'SOLUSDT', 'q': '0.09', 'p': '0.0000', 'm': False, 'c': 'NooinySWfOL0JYqPTEgpbz', 'S': 'BUY', 'L': '164.2300', 'l': '0.09', 't': 2385685825, 'i': 122488420202}
2025-06-11 19:45:58 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 19:45:58 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749642358753, 'E': 1749642358753, 'o': {'s': 'SOLUSDT', 'c': 'NooinySWfOL0JYqPTEgpbz', 'S': 'BUY', 'o': 'MARKET', 'f': 'GTC', 'q': '0.09', 'p': '0', 'ap': '0', 'sp': '0', 'x': 'NEW', 'X': 'NEW', 'i': 122488420202, 'l': '0', 'z': '0', 'L': '0', 'n': '0', 'N': 'USDT', 'T': 1749642358753, 't': 0, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 19:45:58 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122488420202, 'status': 'NEW', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'MARKET', 'qty': '0.09', 'direction': 'LONG', 'created_at': 1749642358753}
2025-06-11 19:45:58 | INFO   | db.py::insertNewOrderByType()         | Attempting to insert new order into DB...
2025-06-11 19:45:59 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders "HTTP/2 201 Created"
2025-06-11 19:45:59 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 19:45:59 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749642358753, 'E': 1749642358753, 'a': {'B': [{'a': 'USDT', 'wb': '99.10755297', 'cw': '99.10755297', 'bc': '0'}], 'P': [{'s': 'SOLUSDT', 'pa': '0.09', 'ep': '164.23', 'cr': '13.85520011', 'up': '0', 'mt': 'cross', 'iw': '0', 'ps': 'BOTH', 'ma': 'USDT', 'bep': '164.312115'}], 'm': 'ORDER'}}
2025-06-11 19:45:59 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 19:45:59 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ORDER_TRADE_UPDATE', 'T': 1749642358753, 'E': 1749642358754, 'o': {'s': 'SOLUSDT', 'c': 'NooinySWfOL0JYqPTEgpbz', 'S': 'BUY', 'o': 'MARKET', 'f': 'GTC', 'q': '0.09', 'p': '0', 'ap': '164.23', 'sp': '0', 'x': 'TRADE', 'X': 'FILLED', 'i': 122488420202, 'l': '0.09', 'z': '0.09', 'L': '164.23', 'n': '0.00739035', 'N': 'USDT', 'T': 1749642358753, 't': 2385685825, 'b': '0', 'a': '0', 'm': False, 'R': False, 'wt': 'CONTRACT_PRICE', 'ot': 'MARKET', 'ps': 'BOTH', 'cp': False, 'rp': '0', 'pP': False, 'si': 0, 'ss': 0, 'V': 'EXPIRE_MAKER', 'pm': 'NONE', 'gtd': 0}}
2025-06-11 19:45:59 | INFO   | event_handler.py::event_parser()      | Successfully parsed event, returning: {'order_id': 122488420202, 'status': 'FILLED', 'symbol': 'SOLUSDT', 'side': 'BUY', 'type': 'MARKET', 'qty': '0.09', 'direction': 'LONG', 'ask_price': '164.23', 'filled_price': '164.23', 'updated_at': 1749642358753}
2025-06-11 19:45:59 | INFO   | db.py::findByIdAndUpdateFilledMarketOrder() | Attempting to UPDATE order 122488420202 to FILLED
2025-06-11 19:45:59 | INFO   | _client.py::_send_single_request()    | HTTP Request: PATCH https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/orders?order_id=eq.122488420202 "HTTP/2 200 OK"
2025-06-11 19:45:59 | INFO   | db.py::get_group_id_by_order()        | Trying to get latest group_id by order: 122488420202
2025-06-11 19:45:59 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=%2A&order_id=eq.122488420202 "HTTP/2 200 OK"
2025-06-11 19:45:59 | INFO   | db.py::get_group_id_by_order()        | No associated group_id found for order_id: 122488420202
2025-06-11 19:45:59 | INFO   | main.py::main()                       | No group_id found for order, inserting a new entry in order_groups table
2025-06-11 19:45:59 | INFO   | db.py::get_latest_group_id()          | Trying to get the latest group_id
2025-06-11 19:45:59 | INFO   | _client.py::_send_single_request()    | HTTP Request: GET https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups?select=group_id&order=group_id.desc&limit=1 "HTTP/2 206 Partial Content"
2025-06-11 19:45:59 | INFO   | db.py::get_latest_group_id()          | Retrieved data=[{'group_id': 0}] count=3 from db
2025-06-11 19:45:59 | INFO   | db.py::insertNewOrderGroup()          | Trying to insert a new order_group record
2025-06-11 19:45:59 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/order_groups "HTTP/2 400 Bad Request"
2025-06-11 19:45:59 | INFO   | db.py::insertNewTrade()               | Attempting to insert new trade into DB...
2025-06-11 19:45:59 | INFO   | _client.py::_send_single_request()    | HTTP Request: POST https://dpiygxjxrqliujdupyxf.supabase.co/rest/v1/trades "HTTP/2 201 Created"
2025-06-11 19:45:59 | INFO   | db.py::insertNewTrade()               | Successfully inserted new trade with group_id 999999999 into trades table.
2025-06-11 19:46:24 | INFO   | main.py::main()                       | ðŸ”´ Awaiting next event in queue from Binance event websocket...
2025-06-11 19:46:24 | INFO   | main.py::main()                       | ðŸ˜± Received new Binance event! Event: {'e': 'ACCOUNT_UPDATE', 'T': 1749642384608, 'E': 1749642384609, 'a': {'B': [{'a': 'USDT', 'wb': '99.19973443', 'cw': '99.19973443', 'bc': '0.09218146'}], 'P': [], 'm': 'DEPOSIT'}}
2025-06-11 19:47:20 | ERROR  | base_events.py::default_exception_handler() | Task was destroyed but it is pending!
task: <Task cancelling name='Task-2' coro=<websocket_binance_event_listener() running at /Users/lei/p/binance-event-listener/src/services/binanceWebsocket.py:35> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:922, Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:767]>
2025-06-11 19:47:20 | ERROR  | base_events.py::default_exception_handler() | Task was destroyed but it is pending!
task: <Task cancelling name='Task-5' coro=<WebSocketCommonProtocol.close_connection() running at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/site-packages/websockets/legacy/protocol.py:1311> wait_for=<Future pending cb=[shield.<locals>._outer_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:922, Task.task_wakeup()]> cb=[gather.<locals>._done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:767, shield.<locals>._inner_done_callback() at /Users/lei/miniconda3/envs/trading-bot/lib/python3.12/asyncio/tasks.py:905]>
